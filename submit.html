<!-- submit.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Review Signed Tx</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
</head>
<body>
  <h2>Review & Send Transaction</h2>
  <pre id="txInfo"></pre>
  <button onclick="sendTx()">Send on BNB Chain</button>

  <script>
    const web3 = new Web3(window.ethereum);
    const txData = JSON.parse(localStorage.getItem("tx_data"));

    document.getElementById("txInfo").innerText = `
Sender:   ${txData.from}
Receiver: ${txData.to}
Amount:   ${txData.value} BNB
Message:  ${txData.message}
Signature: ${txData.signature}
    `;

    async function sendTx() {
      await ethereum.request({ method: 'eth_requestAccounts' });

      const accounts = await web3.eth.getAccounts();
      const sender = accounts[0];

      const tx = {
        from: sender,
        to: txData.to,
        value: web3.utils.toWei(txData.value, "ether"),
        gas: 21000,
        gasPrice: web3.utils.toWei('5', 'gwei')
      };

      web3.eth.sendTransaction(tx)
        .on('transactionHash', hash => {
          alert("Transaction submitted! Tx Hash:\n" + hash);
        })
        .on('error', err => {
          console.error("Tx Error:", err);
          alert("Failed to send tx.");
        });
    }
  </script>
</body>
</html>
